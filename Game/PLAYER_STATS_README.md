# Система характеристик игрока

## Обзор

Система характеристик игрока реализована с соблюдением принципов ООП и SOLID, обеспечивая модульность, расширяемость и легкость тестирования.

## Архитектура

### Основные компоненты

1. **PlayerStats** (`level/player_stats.py`) - главный класс управления характеристиками
2. **PlayerUI** (`UI/player_ui.py`) - интерфейс для отображения характеристик
3. **Player** (`level/player.py`) - обновленный класс игрока с интеграцией характеристик

### Принципы SOLID

#### Single Responsibility Principle (SRP)
- Каждый класс отвечает за одну характеристику:
  - `HealthStat` - управление здоровьем
  - `StaminaStat` - управление выносливостью
  - `ExperienceStat` - управление опытом и уровнем

#### Open/Closed Principle (OCP)
- Система легко расширяется новыми характеристиками без изменения существующего кода
- Новые типы модификаторов можно добавлять через наследование

#### Liskov Substitution Principle (LSP)
- Все характеристики взаимозаменяемы через базовый класс `BaseStat`
- Наблюдатели работают с любыми типами характеристик

#### Interface Segregation Principle (ISP)
- Четкие интерфейсы для каждой характеристики
- `StatObserver` - минимальный интерфейс для наблюдения

#### Dependency Inversion Principle (DIP)
- Зависимости от абстракций, а не от конкретных реализаций
- Использование паттерна Observer для уведомлений

## Характеристики

### Здоровье (Health)
- **Максимальное значение**: 100 HP
- **Функции**:
  - Получение урона (`take_damage`)
  - Восстановление (`heal`)
  - Воскрешение (`revive`)
  - Проверка состояния жизни (`is_alive`)

### Выносливость (Stamina)
- **Максимальное значение**: 100 SP
- **Регенерация**: 10 SP/сек
- **Функции**:
  - Использование выносливости (`use_stamina`)
  - Автоматическая регенерация
  - Проверка истощения (`is_exhausted`)

### Опыт (Experience)
- **Функции**:
  - Получение опыта (`add_experience`)
  - Автоматическое повышение уровня
  - Расчет опыта для следующего уровня

## Модификаторы

Система поддерживает временные и постоянные модификаторы характеристик:

```python
# Временный бонус к здоровью (+20 HP на 10 секунд)
health_bonus = StatModifier(20.0, duration=10.0, source="potion")

# Постоянный процентный бонус к выносливости (+25%)
stamina_bonus = StatModifier(0.25, source="equipment", is_percentage=True)
```

## Интерфейс

### UI элементы
- Полоски здоровья, выносливости и опыта
- Индикаторы урона и лечения
- Экран смерти
- Информация об уровне

### Цветовая схема
- **Здоровье**: Красный (ярко-красный при низком здоровье)
- **Выносливость**: Синий (серый при истощении)
- **Опыт**: Золотой

## Использование

### В коде
```python
# Создание характеристик
player_stats = PlayerStats(max_health=100.0, max_stamina=100.0)

# Получение урона
damage = player_stats.take_damage(25.0)

# Восстановление
heal = player_stats.heal(15.0)

# Использование выносливости
if player_stats.use_stamina(30.0):
    # Действие выполнено
    pass

# Получение опыта
levels_gained = player_stats.add_experience(100.0)
```

### Тестирование

#### В игре
1. **Запустите игру** и нажмите **F3** для включения режима отладки
2. **Тестовые клавиши** (в режиме отладки):
   - **H**: Получить урон (10 HP)
   - **J**: Восстановить здоровье (20 HP)
   - **K**: Использовать выносливость (30 SP)
   - **L**: Получить опыт (50 XP)
   - **R**: Воскреситься (если мертв)

3. **Альтернативные тестовые клавиши** (работают всегда):
   - **1**: Получить урон (10 HP)
   - **2**: Восстановить здоровье (20 HP)
   - **3**: Использовать выносливость (30 SP)
   - **4**: Получить опыт (50 XP)
   - **5**: Воскреситься (если мертв)

#### Отдельный тест
Запустите `test_simple.py` для проверки базовых функций системы:
```bash
python test_simple.py
```

#### Отладочная информация
Если тестовые клавиши не работают, проверьте консоль на наличие отладочных сообщений:
- `[DEBUG] Режим отладки включен/выключен`
- `[DEBUG] Проверка тестовых клавиш`
- `[TEST] Игрок получил урон/восстановился/...`

## Расширение

### Добавление новой характеристики
1. Создайте новый класс, наследующий от `BaseStat`
2. Реализуйте абстрактные методы
3. Добавьте в `PlayerStats`
4. Обновите UI при необходимости

### Пример новой характеристики
```python
class ManaStat(BaseStat):
    def __init__(self, max_mana: float, regen_rate: float = 5.0):
        super().__init__("mana", max_mana, max_mana)
        self.regen_rate = regen_rate
    
    def use_mana(self, amount: float) -> bool:
        if self.current_value < amount:
            return False
        self.current_value -= amount
        return True
    
    def get_display_value(self) -> str:
        return f"{int(self.current_value)}/{int(self.max_value)}"
```

## Интеграция с движением

Система выносливости интегрирована с движением игрока:
- Движение расходует выносливость (10 SP/сек)
- При истощении игрок замедляется
- Выносливость восстанавливается в покое

## Наблюдатели

Система использует паттерн Observer для уведомлений об изменениях:
- UI автоматически обновляется при изменении характеристик
- Можно добавлять дополнительные наблюдатели (звуки, эффекты, достижения)

## Производительность

- Оптимизированные обновления (только при изменениях)
- Эффективное управление модификаторами
- Минимальные накладные расходы на рендеринг 